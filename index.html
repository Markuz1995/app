<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="node_modules/bootstrap/dist/css/bootstrap.min.css">
    <title></title>
  </head>
  <body>
    <button type="button" class="btn btn-primary" name="button" id="crear">Crear recordatrio</button>
    <button type="button" class="btn btn-primary" name="button" id="ver">Ver recordatorios</button>

    <script>window.$ = window.jQuery = require('./js/jquery-3.2.1.min.js');</script>
    <script type="text/javascript">
      const remote = require('electron').remote
      const main = remote.require('./main.js')

      var agregar=document.getElementById('crear')
      var ver=document.getElementById('ver')

      agregar.addEventListener('click', () => {
        main.openWindow()
      })

      ver.addEventListener('click', () => {
        main.openWindow2()
      })
    </script>
    <script type="text/javascript">
       // const notifier = require('node-notifier')
       // const path = require('path');

       // const remote = require('electron').remote
       // const main = remote.require('./main.js')
      const notifier = require('electron-notifications')

       var diasSemana = new Array("Domingo","Lunes","Martes","Miercoles","Jueves","Viernes","Sabado");
       var f=new Date();
       var hoy = diasSemana[f.getDay()];
       $.getScript('./js/conexion.js', function(){

         $queryString = "SELECT * FROM recordatorios WHERE dia ='"+hoy+"';";

         console.log($queryString);
         connection.query($queryString, (err, rows,fields)=>{
           if (err) {
             return console.log("hubo un error",err);
           }

           var datos = JSON.stringify(rows);
           var obj = JSON.parse(datos);
           var repe = 1000;
             setInterval(function(){

               function alerta(dia,hora,descripcion){
                 var dia = dia;
                 var hora = hora;
                 var descripcion = descripcion;

                 const notification = notifier.notify('Calendar', {
                   buttons: ['Abrir'],
                   url: "http://google.com",
                   duration:60000,
                 })

                 notification.on('buttonClicked', (text, buttonIndex, options) => {
                   if (text === 'Abrir') {
                     console.log('abrio');
                     main.openWindow()
                     notification.close()
                   } else if(buttonIndex === 1) {
                     //open options.url
                   }

                 })
               }
               for(i=0;i<obj.length;i++){

                 var dia = obj[i]['dia'];
                 var hora = obj[i]['hora'];
                 var descripcion = obj[i]['descripcion'];

                 var time = new Date();
                 var time2 = time.toLocaleTimeString('en-US', {hour12: true})
                 var tiempo = time2.toString()

                 if (tiempo === '10:39:00 AM') {
                   alerta(dia,hora,descripcion)
                 }else{

                 }
               }

             } , 1000);


          // Just title
          // notifier.notify('Calendar')

          // Full Options
         });

         connection.end(() => {
           console.log("conexion cerrada");
         });
       });

    </script>
  </body>
</html>
